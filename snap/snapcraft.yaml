name: zeronet-js
version: 0.0.1-alpha15
summary: ZeroNet in JS
description: |
  ZeroNet in JavaScript

grade: devel # must be 'stable' to release into candidate/stable channels
confinement: strict

apps:
  zeronet-js:
    aliases:
      - zeronetjs
    command: bin/zeronet
    plugs:
      - network
      - network-bind

parts:
  node:
    plugin: nodejs
    node-engine: 8.2.1
    source: .empty
    build-packages:
      - python
      - g++
      - make
  source:
    plugin: nil
    after:
      - node
    source: .
    build: |
      #cat /etc/passwd | grep "buildd" > /dev/null && cat snap.files/hosts | tee /etc/hosts
      bash scripts/tarball.sh
    install: |
      mkdir -p /tmp/$$/.{npm,node_gyp}
      npm_config_cache="/tmp/$$/.npm" npm_config_devdir="/tmp/$$/.node-gyp" npm_config_prefix="$SNAPCRAFT_PART_INSTALL" npm shrinkwrap
      node scripts/no-git-deps.js npm-shrinkwrap.json
      npm_config_cache="/tmp/$$/.npm" npm_config_devdir="/tmp/$$/.node-gyp" npm_config_prefix="$SNAPCRAFT_PART_INSTALL" bash scripts/global.sh
      rm -rf /tmp/$$
